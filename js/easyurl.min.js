window.easyurl||(window.easyurl={},window.easyurl.scriptsLoaded=!1),window.easyurl.scriptsLoaded||(window.easyurl.init=function(){window.easyurl.load_list_script()},window.easyurl.load_list_script=function(){if(!window.easyurl.scriptsLoaded){let e=void 0,o=void 0;for(e in window.easyurl)for(o in window.easyurl[e].init&&window.easyurl[e].init(),window.easyurl[e])window.easyurl[e]&&window.easyurl[e][o]&&window.easyurl[e][o].init&&window.easyurl[e][o].init();window.easyurl.scriptsLoaded=!0}},window.easyurl.refresh=function(){let e=void 0,o=void 0;for(e in window.easyurl)for(o in window.easyurl[e].refresh&&window.easyurl[e].refresh(),window.easyurl[e])window.easyurl[e]&&window.easyurl[e][o]&&window.easyurl[e][o].refresh&&window.easyurl[e][o].refresh()},$(document).ready(window.easyurl.init)),window.easyurl.shortener={},window.easyurl.shortener.init=function(){window.easyurl.shortener.event()},window.easyurl.shortener.event=function(){$(document).on("click",".toggleObjectInfo",window.easyurl.shortener.toggleObjectInfo),$(document).on("click",".show-qrcode",window.easyurl.shortener.showQRCode),$(document).on("change","#fromid",window.easyurl.shortener.reloadAssignShortenerView),$(document).on("click",".button-save.assign-button",window.easyurl.shortener.assignShortener)},window.easyurl.shortener.toggleObjectInfo=function(){$(this).hasClass("fa-minus-square")?($(this).removeClass("fa-minus-square").addClass("fa-caret-square-down"),$(this).closest(".fiche").find(".ObjectInfo tbody").hide()):($(this).removeClass("fa-caret-square-down").addClass("fa-minus-square"),$(this).closest(".fiche").find(".ObjectInfo tbody").show())},window.easyurl.shortener.showQRCode=function(){var e=window.saturne.toolbox.getQuerySeparator(document.URL),o=window.saturne.toolbox.getToken();let r;r=$(this).hasClass("fa-toggle-off")?1:0,window.saturne.loader.display($(this)),$.ajax({url:document.URL+e+"action=show_qrcode&token="+o,type:"POST",processData:!1,data:JSON.stringify({showQRCode:r}),contentType:!1,success:function(e){window.location.reload()},error:function(){}})},window.easyurl.shortener.reloadAssignShortenerView=function(){var e=$(this).val(),o=window.saturne.toolbox.getToken(),r=window.saturne.toolbox.getQuerySeparator(document.URL);window.saturne.loader.display($(".assign-form")),$.ajax({url:document.URL+r+"fromid="+e+"&token="+o,type:"POST",processData:!1,contentType:!1,success:function(e){$(".assign-form").replaceWith($(e).find(".assign-form"))},error:function(){}})},window.easyurl.shortener.assignShortener=function(){var e=window.saturne.toolbox.getToken(),o=window.saturne.toolbox.getQuerySeparator(document.URL);$.ajax({url:document.URL+o+"view&token="+e,type:"POST",processData:!1,contentType:!1,success:function(){window.parent.jQuery("#idfordialogassignShortener").dialog("close")},error:function(){}})},window.easyurl.urlexport={},window.easyurl.urlexport.init=function(){window.easyurl.urlexport.event()},window.easyurl.urlexport.event=function(){$(".button-save","#generate-url-from").on("click",window.easyurl.urlexport.saveButton)},window.easyurl.urlexport.saveButton=function(e){e.preventDefault(),window.easyurl.urlexport.hideNotice();let o=$("#generate-url-from").serializeArray().find(e=>"nb_url"==e.name);$.ajax({method:"POST",url:"",data:$("#generate-url-from").serialize(),success:e=>{(new Date).toLocaleString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}).replace(",","");$('<tr class="oddeven"><td class="tab-ref">'+e.ref+'</td><td class="tab-count">-</td><td class="tab-first">-</td><td class="tab-end">-</td><td class="tab-date">'+e.date+'</td><td class="tab-url">-</td><td class="tab-uses">0</td><td class="tab-download"><div class="wpeo-loader"><span class="loader-spin"></span></div></td></tr>').insertAfter($("tr:nth-child(1)",".tab-export")),$(".button-save","#generate-url-from").addClass("wpeo-loader"),window.easyurl.urlexport.createUrls(e.data,0,parseInt(o.value))},error:function(e,o,r){window.easyurl.urlexport.displayNotice(e.responseJSON.title,e.responseJSON.message,"error"),$(".button-save","#generate-url-from").removeClass("wpeo-loader")}})},window.easyurl.urlexport.createUrls=function(o,r,t){r!=t?$.ajax({method:"POST",url:"",data:$("#generate-url-from").serialize()+"&export_url_id="+o,success:e=>{$("tr:nth-child(2)",".tab-export").find(".tab-count").html(r+1),0==r&&($("tr:nth-child(2)",".tab-export").find(".tab-first").html(e.data),$("tr:nth-child(2)",".tab-export").find(".tab-url").html('<span class="fas fa-external-link-alt paddingrightonly" style=""></span><span>'+e.url+"</span>")),$("tr:nth-child(2)",".tab-export").find(".tab-end").html(e.data),window.easyurl.urlexport.createUrls(o,r+1,t)},error:function(e,o,r){window.easyurl.urlexport.displayNotice(e.responseJSON.title,e.responseJSON.message,"error"),$("tr:nth-child(2)",".tab-export").remove(),$(".button-save","#generate-url-from").removeClass("wpeo-loader")}}):$.ajax({method:"POST",url:"",data:$("#generate-url-from").serialize()+"&export_url_id="+o+"&export_file=1",success:e=>{window.easyurl.urlexport.displayNotice(e.title,e.message,"success"),$("tr:nth-child(2)",".tab-export").find(".tab-download").html(e.download),$(".button-save","#generate-url-from").removeClass("wpeo-loader"),window.open(e.redirect,"_blank").focus()},error:function(e,o,r){window.easyurl.urlexport.displayNotice(e.responseJSON.title,e.responseJSON.message,"error"),$("tr:nth-child(2)",".tab-export").remove(),$(".button-save","#generate-url-from").removeClass("wpeo-loader")}})},window.easyurl.urlexport.displayNotice=function(e,o,r){var t=$(".global-infos");t.removeClass("notice-error"),t.removeClass("notice-info"),t.removeClass("notice-success"),t.removeClass("hidden"),t.addClass("notice-"+r),$("span",t).remove(),t.find(".notice-title").append("<span>"+e+"</span>"),t.find(".notice-content").append("<span>"+o+"</span>"),t.show()},window.easyurl.urlexport.hideNotice=function(){$(".global-infos").hide()};